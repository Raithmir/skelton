{{/*
  Menu override to support enable/disable system
  Filters menu items based on .Params.enabled (default: true)
*/}}

{{ $currentPage := . }}
{{ $menuName := "main" }}

{{ if .Site.Menus.main }}
<nav class="flex items-center justify-between" aria-label="Main navigation">
  <ul class="flex flex-wrap items-center gap-x-6 gap-y-2">
    {{ range .Site.Menus.main }}
      {{ $enabled := true }}
      {{ if isset .Params "enabled" }}
        {{ $enabled = .Params.enabled }}
      {{ end }}

      {{ if $enabled }}
        {{ if not .HasChildren }}
          {{/* Regular menu item without children */}}
          <li>
            <a
              href="{{ .URL | relLangURL }}"
              class="flex items-center text-base font-medium text-neutral-700 hover:text-primary-600 dark:text-neutral-300 dark:hover:text-primary-400 transition-colors"
              {{ if $currentPage.IsMenuCurrent $menuName . }}aria-current="page"{{ end }}
            >
              {{ .Pre }}
              <span>{{ .Name }}</span>
              {{ .Post }}
            </a>
          </li>
        {{ else }}
          {{/* Dropdown menu item with children */}}
          <li class="relative group">
            <button
              type="button"
              class="flex items-center gap-1 text-base font-medium text-neutral-700 hover:text-primary-600 dark:text-neutral-300 dark:hover:text-primary-400 transition-colors"
              aria-expanded="false"
              aria-haspopup="true"
            >
              {{ .Pre }}
              <span>{{ .Name }}</span>
              <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
              {{ .Post }}
            </button>

            {{/* Dropdown menu */}}
            <ul class="absolute left-0 top-full mt-2 min-w-[200px] py-2 bg-white dark:bg-neutral-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
              {{ range .Children }}
                {{ $childEnabled := true }}
                {{ if isset .Params "enabled" }}
                  {{ $childEnabled = .Params.enabled }}
                {{ end }}

                {{ if $childEnabled }}
                  <li>
                    <a
                      href="{{ .URL | relLangURL }}"
                      class="block px-4 py-2 text-sm text-neutral-700 hover:bg-primary-50 hover:text-primary-600 dark:text-neutral-300 dark:hover:bg-neutral-700 dark:hover:text-primary-400 transition-colors"
                      {{ if $currentPage.IsMenuCurrent $menuName . }}aria-current="page"{{ end }}
                    >
                      {{ .Pre }}
                      <span>{{ .Name }}</span>
                      {{ .Post }}
                    </a>
                  </li>
                {{ end }}
              {{ end }}
            </ul>
          </li>
        {{ end }}
      {{ end }}
    {{ end }}
  </ul>
</nav>
{{ end }}
