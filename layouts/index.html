{{ define "main" }}
<div class="relative">
  <!-- Hero Section -->
  <section class="mb-10">
    <div class="hero-gradient relative overflow-hidden">
      <!-- Decorative circles -->
      <div class="absolute inset-0 opacity-20">
        <div class="absolute -right-10 -top-10 w-64 h-64 rounded-full bg-white/20"></div>
        <div class="absolute -left-10 -bottom-10 w-48 h-48 rounded-full bg-white/10"></div>
        <div class="absolute right-1/3 -bottom-8 w-36 h-36 rounded-full bg-white/15"></div>
      </div>
      <div class="relative z-10">
        <div class="flex items-center gap-3 mb-4">
          <svg class="w-10 h-10 text-primary-600 dark:text-white flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
          </svg>
          <h1 class="text-4xl md:text-5xl font-bold">
            Welcome to Skelton Gate
          </h1>
        </div>
        <p class="text-xl text-neutral-600 dark:text-neutral-100 max-w-3xl">
          Your local community hub for events, businesses, walking routes, and community notices.
        </p>
      </div>
    </div>
  </section>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <!-- Main Content Area (Left 2 columns) -->
    <div class="lg:col-span-2 space-y-10">

      <!-- Priority Notices Section -->
      <section class="notices-section">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-3xl font-bold text-neutral-900 dark:text-neutral-100">Important Notices</h2>
          <a href="/notices/" class="text-primary-600 dark:text-primary-400 hover:underline">View all →</a>
        </div>

        <div class="space-y-4">
          {{ $notices := where site.RegularPages "Section" "notices" }}
          {{ $notices = where $notices ".Params.draft" "!=" true }}
          {{ $activeNotices := slice }}
          {{ range $notices }}
            {{ $expired := false }}
            {{ if .Params.expiryDate }}
              {{ $expiryDate := time.AsTime .Params.expiryDate }}
              {{ if lt $expiryDate now }}
                {{ $expired = true }}
              {{ end }}
            {{ end }}
            {{ if not $expired }}
              {{ $activeNotices = $activeNotices | append . }}
            {{ end }}
          {{ end }}

          {{ range first 3 $activeNotices }}
            {{ $priorityClass := "bg-neutral-100 dark:bg-neutral-700 border-l-4 border-neutral-400" }}
            {{ if eq (lower .Params.priority) "urgent" }}
              {{ $priorityClass = "bg-red-50 dark:bg-red-900/20 border-l-4 border-red-600" }}
            {{ else if eq (lower .Params.priority) "high" }}
              {{ $priorityClass = "bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500" }}
            {{ else if eq (lower .Params.priority) "normal" }}
              {{ $priorityClass = "bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500" }}
            {{ else if eq (lower .Params.priority) "low" }}
              {{ $priorityClass = "bg-gray-50 dark:bg-gray-800 border-l-4 border-gray-400" }}
            {{ end }}

            <article class="rounded-lg {{ $priorityClass }} p-6 transition-shadow hover:shadow-md">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h3 class="text-xl font-semibold text-neutral-900 dark:text-neutral-100">
                      <a href="{{ .Permalink }}" class="hover:text-primary-600 dark:hover:text-primary-400">
                        {{ .Title }}
                      </a>
                    </h3>
                    <span class="px-2 py-1 text-xs font-semibold rounded uppercase {{ if eq (lower .Params.priority) "urgent" }}bg-red-600 text-white{{ else if eq (lower .Params.priority) "high" }}bg-orange-600 text-white{{ else }}bg-neutral-600 text-white{{ end }}">
                      {{ .Params.priority }}
                    </span>
                  </div>
                  <div class="prose dark:prose-invert max-w-none">
                    {{ .Summary }}
                  </div>
                  <div class="mt-3">
                    <a href="{{ .Permalink }}" class="text-primary-600 dark:text-primary-400 hover:underline text-sm font-medium">
                      Read more →
                    </a>
                  </div>
                </div>
              </div>
            </article>
          {{ else }}
            <p class="text-neutral-600 dark:text-neutral-400">No active notices at this time.</p>
          {{ end }}
        </div>
      </section>

      <!-- Upcoming Events Section -->
      <section class="events-section">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-3xl font-bold text-neutral-900 dark:text-neutral-100">Upcoming Events</h2>
          <a href="/events/" class="text-primary-600 dark:text-primary-400 hover:underline">View calendar →</a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          {{ $events := where site.RegularPages "Section" "events" }}
          {{ $events = where $events ".Params.draft" "!=" true }}
          {{ $upcomingEvents := slice }}
          {{ range $events }}
            {{ if .Params.eventDate }}
              {{ $eventDate := time.AsTime .Params.eventDate }}
              {{ if ge $eventDate now }}
                {{ $upcomingEvents = $upcomingEvents | append . }}
              {{ end }}
            {{ end }}
          {{ end }}
          {{ $upcomingEvents = sort $upcomingEvents ".Params.eventDate" }}

          {{ range first 4 $upcomingEvents }}
            <article class="rounded-lg bg-neutral-100 dark:bg-neutral-700 overflow-hidden transition-shadow hover:shadow-lg">
              <div class="p-6">
                <div class="flex items-start gap-4">
                  <div class="flex-shrink-0 text-center">
                    <div class="bg-primary-600 text-white rounded-lg flex flex-col items-center justify-center" style="width:5rem;height:5rem">
                      <div class="text-2xl font-bold">{{ time.Format "2" .Params.eventDate }}</div>
                      <div class="text-xs uppercase">{{ time.Format "Jan" .Params.eventDate }}</div>
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-2">
                      <a href="{{ .Permalink }}" class="hover:text-primary-600 dark:hover:text-primary-400">
                        {{ .Title }}
                      </a>
                    </h3>
                    {{ if .Params.eventTime }}
                      <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-1">
                        <svg class="inline w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        {{ .Params.eventTime }}
                      </p>
                    {{ end }}
                    {{ if .Params.location }}
                      <p class="text-sm text-neutral-600 dark:text-neutral-400 truncate">
                        <svg class="inline w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                        {{ .Params.location }}
                      </p>
                    {{ end }}
                  </div>
                </div>
              </div>
            </article>
          {{ else }}
            <p class="text-neutral-600 dark:text-neutral-400 col-span-2">No upcoming events scheduled.</p>
          {{ end }}
        </div>
      </section>

      <!-- Local Businesses Section -->
      <section class="businesses-section">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-3xl font-bold text-neutral-900 dark:text-neutral-100">Local Businesses</h2>
          <a href="/businesses/" class="text-primary-600 dark:text-primary-400 hover:underline">Browse directory →</a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {{ range first 6 (where (where site.RegularPages "Section" "businesses") ".Params.draft" "!=" true) }}
            <article class="rounded-lg bg-neutral-100 dark:bg-neutral-700 p-4 hover:shadow-md transition-shadow">
              <h3 class="font-semibold text-neutral-900 dark:text-neutral-100 mb-1">
                <a href="{{ .Permalink }}" class="hover:text-primary-600 dark:hover:text-primary-400">
                  {{ .Title }}
                </a>
              </h3>
              {{ if .Params.category }}
                <p class="text-sm text-neutral-600 dark:text-neutral-400 capitalize">{{ .Params.category }}</p>
              {{ end }}
            </article>
          {{ else }}
            <p class="text-neutral-600 dark:text-neutral-400 col-span-3">No businesses listed yet.</p>
          {{ end }}
        </div>
      </section>

    </div>

    <!-- Sidebar (Right column) -->
    <aside class="lg:col-span-1 space-y-6">

      <!-- Quick Links Widget -->
      <div class="rounded-lg bg-neutral-100 dark:bg-neutral-700 p-6">
        <h3 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 mb-4">Quick Links</h3>
        <nav class="space-y-3">
          {{ $sections := dict "events" "Events" "businesses" "Businesses" "amenities" "Amenities" "services" "Services" "healthcare" "Healthcare" "schools" "Schools" "transport" "Transport" "walks" "Walking Routes" "notices" "Notices" "faqs" "FAQs" "broadband" "Broadband" "bin-collection" "Bin Collection" "contacts" "Contacts" }}
          {{ range $section, $title := $sections }}
            {{ $count := len (where site.RegularPages "Section" $section) }}
            <a href="/{{ $section }}/" class="flex items-center justify-between p-3 rounded hover:bg-primary-100 dark:hover:bg-primary-900 transition-colors group">
              <span class="font-medium text-neutral-900 dark:text-neutral-100 group-hover:text-primary-600 dark:group-hover:text-primary-400">
                {{ $title }}
              </span>
              <span class="px-2 py-1 text-xs font-semibold rounded bg-primary-600 text-white">
                {{ $count }}
              </span>
            </a>
          {{ end }}
        </nav>
      </div>

      <!-- Bin Collection Widget -->
      {{ partial "widgets/bin-collection.html" . }}

      <!-- Walking Routes Widget -->
      <div class="rounded-lg bg-neutral-100 dark:bg-neutral-700 p-6">
        <h3 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 mb-4">Walking Routes</h3>
        <div class="space-y-3">
          {{ range first 3 (where site.RegularPages "Section" "walks") }}
            <div class="border-l-2 border-green-600 pl-3">
              <a href="{{ .Permalink }}" class="block hover:text-primary-600 dark:hover:text-primary-400">
                <p class="font-medium text-sm text-neutral-900 dark:text-neutral-100">{{ .Title }}</p>
                <div class="flex items-center gap-2 mt-1 text-xs text-neutral-600 dark:text-neutral-400">
                  {{ if .Params.distance }}<span>{{ .Params.distance }}</span>{{ end }}
                  {{ if and .Params.distance .Params.difficulty }}<span>•</span>{{ end }}
                  {{ if .Params.difficulty }}<span class="capitalize">{{ .Params.difficulty }}</span>{{ end }}
                </div>
              </a>
            </div>
          {{ end }}
        </div>
        <a href="/walks/" class="block mt-4 text-sm text-primary-600 dark:text-primary-400 hover:underline">
          View all routes →
        </a>
      </div>

      <!-- Crime Stats Widget -->
      {{ if site.Data.site_settings.showCrimeStats }}
        {{ partial "widgets/crime-stats.html" . }}
      {{ end }}

    </aside>
  </div>
</div>
{{ end }}
